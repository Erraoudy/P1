{% extends 'TWCOndeBundle::ondelayout.html.twig' %}
{% block Title %}Homepage {% endblock %}
{% block Style %}
    {{parent()}}
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote.css">
    <link href="{{ asset('assets/css/dropzone.css') }}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.css">

    <style type="text/css" media="screen">
        .entry-title{
            color: #1e1e1e !important;
        }
        .note-group-select-from-files{
            display: none;
        }
        .xs-banner-inner-section{
            padding-bottom: 0px;
        }
        #forgot-form-a{
            display: none;
        }
        .container-m {
          position: relative;
          height: 160px;
          width: 160px;
          text-align: center;
          border: 1px solid #eee;
          border-radius: 5px;
          cursor: pointer;
        }
        .container-m img{    
            margin-top: 5px;
        }

        .overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0);
          transition: background 0.5s ease;
        }

        .container-m:hover .overlay {
          display: block;
          background: rgba(0, 0, 0, .3);
        }

        .img-media {
          position: absolute;
          width: 500px;
          height: 300px;
          left: 0;
        }

        .button-media {
            position: absolute;
            width: 70%;
            top: 45%;
            margin: auto;
            padding: 0.3rem;
            margin-left: 2.4rem;
            text-align: center;
            opacity: 0;
            transition: opacity .35s ease;
        }

        .button-media a {
          width: 200px;
          padding: 12px 48px;
          text-align: center;
          color: white;
          border: solid 2px white;
          z-index: 1;
          text-decoration: none;
        }

        .container-m:hover .button-media {
          opacity: 1;
        }
        .form-control{
            display: inline-block;
        }


        .tooltip {
          position: relative;
          display: inline-block;
          width: 100%;
          height: 100%;
          opacity: initial;
        }

        .tooltip .tooltiptext {
          visibility: hidden;
          width: 140px;
          background-color: #555;
          color: #fff;
          text-align: center;
          border-radius: 6px;
          padding: 5px;
          position: absolute;
          z-index: 1;
          bottom: 150%;
          left: 50%;
          margin-left: -75px;
          opacity: 0;
          transition: opacity 0.3s;
        }

        .tooltip .tooltiptext::after {
          content: "";
          position: absolute;
          top: 100%;
          left: 50%;
          margin-left: -5px;
          border-width: 5px;
          border-style: solid;
          border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
          visibility: visible;
          opacity: 1;
        }
        .dz-preview.dz-complete.dz-image-preview .dz-image img{
            max-width: 100px;
            max-height: 100px;
        }
        .dz-preview.dz-complete.dz-image-preview .dz-details{
            display: none;
        }
        .img-bg{
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
            height: 160px;
        }
        .content-img{
            overflow: auto;
            max-height: 100vh;
        }

    </style>
{% if app.request.locale == "ar" %}
<style type="text/css" media="screen">
    
    
    .xs-unorder-list li i{
        padding-left: 17px;
    }
    .text-icon-mis{
        text-align: center !important;
    }
    .xs-contact-form .input-group-text{
        border-left: 2px solid #eeeeee;
        border-right: 0;
    }
    .xs-contact-form input:not([type="submit"]), .xs-contact-form textarea{
        border-left: 0;
        border-right: 2px solid #eeeeee;
    }
    .xs-service-promo h5, .xs-service-promo p ,.xs-post-entry-title a,.xs-event-content p,{
        font-size: 20px;
    }
    .blockq-img{
        font-size: 18px;
    }
</style>
{% endif %}
{% endblock %}
{% block body %}
    {% include "TWCOndeBundle:Admin:header.html.twig" %} 
    <section class="xs-banner-inner-section parallax-window" style="background-image:url('{{asset('front/images/backgrounds/mission_bg.jpg')}}');">
        <div class="xs-black-overlay"></div>
            <div class="color-white xs-inner-banner-content pb-3">
                <h2>Actualitée</h2>
            </div>
        </section>
    </section>
    

    <main class="xs-main">
        <section class="xs-content-section-padding">
            <div class="container text-left">
                <form action="{{path('onde_add_article',{'id':article.id})}}" method="POST" id="formMedia">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="">
                                <label for="title">Title</label>
                                <input type="text" class="form-control" name="title" value="{{article.titre}}">
                            </div>
                            <div class="editor-wrapper">
                                <label for="contenu">Contenu</label>
                                <textarea name="mediaEditor" id="editor" class="editor">{{article.contenu}}</textarea>
                                {# <div class="summernote" id="editor"></div> #}
                                {# <div class="summernote" id="editor">dd</div> #}
                            </div>
                            <label for="title">Image</label>
                            <div id="avatar" class="dropzone">
                                <input name="fileprofil" type="file">
                                <div class="dz-default dz-message">
                                    <span>add Image</span>
                                </div>
                                {% if article.image|length > 0 %}
                                    {% for item in article.image %}
                                        <div class="dz-preview dz-file-preview ">
                                          <div class="dz-details">
                                            <div class="dz-filename"><span data-dz-name></span></div>
                                            <div class="dz-size" data-dz-size></div>
                                            <img data-dz-thumbnail style="display: block !important;" src="{{ item.objectKey != null ? asset(item.objectKey) }}" />
                                          </div>
                                          <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>
                                          <div class="dz-success-mark"><span>✔</span></div>
                                          <div class="dz-error-mark"><span>✘</span></div>
                                          <div class="dz-error-message"><span data-dz-errormessage></span></div>
                                          <a class="dz-remove deleteImage" data-id="{{item.id}}" data-dz-remove="">Remove file</a>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                                
                            </div>

                            <input type="text" name="url-img" id="url-img" style="opacity:0;">
                            <button type="submit" class="btn btn-primary pull-right btn-md btn-success">Send</button>
                        </div>
                        <div class="col-md-4" style="margin-top: 10px;">
                            <div class="row content-img">
                                <div class="col-md-6 my-4">
                                    <div class="container-m" data-toggle="modal" data-target="#modalAddPicture">
                                        <img src="https://img.icons8.com/color/144/000000/add.png">
                                    </div>
                                </div>
                                {% for key,item in pictures %}
                                    <div class="col-md-6 my-4">
                                        <div class="container-m img-bg" style='background-image: url({{ item.objectKey != null ? asset(item.objectKey) : asset('assets/images/noimage.png') }})' data-src="{{asset(item.objectKey)}}" id="myInput{{key}}">
                                            {# <img class="img-media" src="{{ item.objectKey != null ? asset(item.objectKey) : asset('assets/images/noimage.png') }}"  alt="" /> #}
                                            <div class="overlay"></div>
                                            <div class="tooltip">
                                                <button  type="button" onmouseout="outFunc()" class='button-media'>
                                                    <span class="tooltiptext" id="myTooltip">Copy to clipboard</span>
                                                    Copy text
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                    </div>
                </form>
            </div>
        </section>

    </main>
<div class="modal fade" id="modalAddPicture" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Basic Modal</h4>
      </div>
      <div class="modal-body">
        <div id="newPicture" class="dropzone">
            <input name="fileprofil" type="file">
            <div class="dz-default dz-message">
                <span>add Image article</span>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
    {{ render(controller("TWCOndeBundle:Default:footer")) }}
{% endblock %}
{% block custom_js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote.js" type="text/javascript"></script>
    <script type="text/javascript" src="{{ asset('assets/js/dropzone.js') }}"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.js"></script>
    <script type="text/javascript">
        myUrl = {
            currentPage: 'addMedia',
            addPicture: "{{path('onde_add_img_picture')}}",
            redirectUrl: ""
        };
    </script>
    <script type="text/javascript" src="{{ asset('assets/js/addPicture.js') }}"></script>
    <script type="text/javascript">
        $( document ).ready(function() {
            $(".blue-header").css('display','none');
        });
    </script>
    <script>
        $(document).ready(function() {
            $('.summernote').summernote();
            $("#editor").summernote({
                height: 300, // set editor height (toolbar not included???)
                focus: false, // set focus to editable area after initializing summernote
                toolbar: [
                  // [groupName, [list of button]]
                  ["style", ["bold", "italic", "underline", "clear"]],
                  ["font", ["strikethrough", "superscript", "subscript"]],
                  ["fontsize", ["fontsize"]],
                  ["color", ["color"]],
                  ["para", ["ul", "ol", "paragraph"]],
                  ["height", ["height"]],
                  ['insert', ['link', 'picture']]
                ]
            });
        });

    </script>
    <script>
        Dropzone.autoDiscover = false;

        var myDropZone = new Dropzone("#avatar", { //id form

            url: "{{path('onde_add_img_article',{'id':article.id})}}",
            paramName: "file",
            parallelUploads: 1,
            uploadMultiple: true,
            acceptedFiles: ".png,.jpg,.gif,.jpeg,.bmp",
            clickable: "#avatar", //id div drop
            autoProcessQueue: false,
            addRemoveLinks: true,

            init: function() { 
                myDropzone = this;
            }

        });

        
        myDropZone.on("addedfile", function(file) {
            // $('.dz-message').remove();
            // $('.dz-details').css("display","none");
            $('.dz-success-mark').css("display","none");
            $('.dz-error-mark').css("display","none");
            // if (this.files.length > 1) {
            //     this.removeFile(this.files[0]);
            // }
            // if (this.files.length > 0) {
            //    $('.dzresize120').parent().remove();
            // }

            // $(dz-file-preview.previewElement).remove();
            // $('.dz-file-preview').prepend($(file.previewElement));
            // $('.dz-file-preview').first().remove();
        });


        myDropZone.on("removedfile", function(file, response) {
            $("#picture").val(""); 
        });
        myDropZone.on("success", function(file, response) {
            console.log(response);
            $("#picture").val("success"); 
            $("#photo").removeClass("divrederror");
            $("#picture-error").addClass("nodisplay");
            $("#picture-error2").addClass("nodisplay");
        });
        myDropZone.on("error", function(file, response) {
            
        });

        myDropZone.on("sendingmultiple", function(file, xhr, formData) {

        });

        myDropZone.on("processingmultiple", function(file, xhr, formData) {

        });

        // transform cropper dataURI output to a Blob which Dropzone accepts
        function dataURItoBlob(dataURI) {
            var byteString = atob(dataURI.split(',')[1]);
            var ab = new ArrayBuffer(byteString.length);
            var ia = new Uint8Array(ab);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: 'image/jpeg' });
        }
        // modal window template
        var modalTemplate = '<div class="modal fade" tabindex="-1" role="dialog">'+
                                '<div class="modal-dialog" role="document">'+
                                    '<div class="modal-content">'+
                                        '<div class="modal-body">'+
                                            '<div class="image-container"></div>'+
                                        '</div>'+
                                        '<div class="modal-footer">'+
                                            '<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>'+
                                            '<button type="button" class="btn btn-primary crop-upload">Upload</button>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>';


        // listen to thumbnail event
        myDropZone.on('thumbnail', function (file) {

            // ignore files which were already cropped and re-rendered
            // to prevent infinite loop
            if (file.cropped) {
                return;
            }
            // cache filename to re-assign it to cropped file
            var cachedFilename = file.name;
            // remove not cropped file from dropzone (we will replace it later)
            myDropZone.removeFile(file);

            // dynamically create modals to allow multiple files processing
            var $cropperModal = $(modalTemplate);
            // 'Crop and Upload' button in a modal
            var $uploadCrop = $cropperModal.find('.crop-upload');

            var $img = $('<img />');
            // initialize FileReader which reads uploaded file
            var reader = new FileReader();
            reader.onloadend = function () {
                // add uploaded and read image to modal
                $cropperModal.find('.image-container').html($img);
                $img.attr('src', reader.result);

                // initialize cropper for uploaded image
                $img.cropper({
                    // aspectRatio: 1,
                    autoCropArea: 1,
                    movable: false,
                    rotatable: true,
                    cropBoxResizable: true,
                    minContainerWidth: 470,
                    minContainerHeight: 300
                });
            };
           
            // read uploaded file (triggers code above)
            reader.readAsDataURL(file);

            $cropperModal.modal('show');

            // listener for 'Crop and Upload' button in modal
            $uploadCrop.on('click', function() {
                // get cropped image data
                var blob = $img.cropper('getCroppedCanvas').toDataURL();
                // transform it to Blob object
                var newFile = dataURItoBlob(blob);
                // set 'cropped to true' (so that we don't get to that listener again)
                newFile.cropped = true;
                // assign original filename
                newFile.name = cachedFilename;

                // add cropped file to dropzone
                myDropZone.addFile(newFile);
                // upload cropped file with dropzone
                myDropZone.processQueue();
                $cropperModal.modal('hide');
            });
        });

       
        $(document).ready(function(e){
            $('.deleteImage').on('click', function(e) {
                let local= $(this);
                var idImage = $(this).attr("data-id");
                $.ajax({
                    type: 'POST',
                    url: "{{ path('onde_delete_img_article') }}/"+idImage,
                    success: function(data) {
                        console.log("delete success");
                            local.parents(".dz-file-preview").remove();
                        },
                    error: function(data) {
                    
                    },
                });
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function() { 
            $('.modal-dialog .note-image-btn').on('click', function(e) {
                var imageUrl = $('.modal-dialog .note-image-url').val();
                $('#url-img').val(imageUrl);
            });

            $('.button-media').on('click', function(e) {
                // console.log($(this).parents(".container-m").attr('class'))
                $('#url-img').val("{{ app.request.getSchemeAndHttpHost() }}" + $(this).parents(".container-m").attr("data-src"));
                myFunction();
            });
            
        });
        </script>
        <script type="text/javascript">
            function myFunction() {
              var copyText = document.getElementById("url-img");
              copyText.select();
              copyText.setSelectionRange(0, 99999);
              document.execCommand("copy");
              
              var tooltip = document.getElementById("myTooltip");
              tooltip.innerHTML = "Copied: " + copyText.value;
            }

            function outFunc() {
              var tooltip = document.getElementById("myTooltip");
              tooltip.innerHTML = "Copy to clipboard";
            }
        </script>
{% endblock %}